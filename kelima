-- Training Points Multiplier - FIXED & STABLE VERSION
-- No threading errors, clean execution

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Settings
local Settings = {
    GainMultiplier = 5556,
    AutoTrain = false,
    Enabled = false
}

local Stats = {
    TotalGains = 0,
    TrainingSessions = 0
}

-- GUI Variables (declare first)
local StatusLabel, StatsLabel, SessionLabel, MultTitle, MultValue, MultFill

-- Helper Functions
local function FormatNumber(n)
    if n >= 1e9 then return string.format("%.2fB", n / 1e9)
    elseif n >= 1e6 then return string.format("%.2fM", n / 1e6)
    elseif n >= 1e3 then return string.format("%.1fK", n / 1e3)
    else return tostring(math.floor(n)) end
end

local function SafeUpdateUI()
    if StatusLabel and StatusLabel.Parent then
        pcall(function()
            MultTitle.Text = string.format("âš¡ MULTIPLIER: x%s", FormatNumber(Settings.GainMultiplier))
            MultValue.Text = string.format("x%s", FormatNumber(Settings.GainMultiplier))
            
            local result = 180 * Settings.GainMultiplier
            StatsLabel.Text = string.format("ðŸ’Ž +180 â†’ +%s per training", FormatNumber(result))
            
            local logValue = math.log(Settings.GainMultiplier) / math.log(1000000)
            MultFill.Size = UDim2.new(math.clamp(logValue, 0, 1), 0, 1, 0)
            
            SessionLabel.Text = string.format("ðŸŽ¯ Sessions: %d | Boosted: +%s", 
                Stats.TrainingSessions, FormatNumber(Stats.TotalGains))
        end)
    end
end

local function Notify(text)
    pcall(function()
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "Training Multiplier",
            Text = text,
            Duration = 3
        })
    end)
end

-- Create GUI (Safe creation)
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "TrainingMultiplierGUI"
ScreenGui.ResetOnSpawn = false

pcall(function() ScreenGui.Parent = game:GetService("CoreGui") end)
if not ScreenGui.Parent then ScreenGui.Parent = playerGui end

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 380, 0, 400)
MainFrame.Position = UDim2.new(0.5, -190, 0.5, -200)
MainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 25)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 12)
MainCorner.Parent = MainFrame

local MainStroke = Instance.new("UIStroke")
MainStroke.Color = Color3.fromRGB(255, 100, 255)
MainStroke.Thickness = 2
MainStroke.Parent = MainFrame

-- Top Bar
local TopBar = Instance.new("Frame")
TopBar.Size = UDim2.new(1, 0, 0, 50)
TopBar.BackgroundColor3 = Color3.fromRGB(25, 25, 40)
TopBar.BorderSizePixel = 0
TopBar.Parent = MainFrame

local TopCorner = Instance.new("UICorner")
TopCorner.CornerRadius = UDim.new(0, 12)
TopCorner.Parent = TopBar

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -70, 1, 0)
Title.Position = UDim2.new(0, 15, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "âš¡ EXTREME BOOSTER"
Title.TextColor3 = Color3.fromRGB(255, 100, 255)
Title.TextSize = 20
Title.Font = Enum.Font.GothamBold
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = TopBar

local MinimizeBtn = Instance.new("TextButton")
MinimizeBtn.Size = UDim2.new(0, 32, 0, 32)
MinimizeBtn.Position = UDim2.new(1, -65, 0, 9)
MinimizeBtn.BackgroundColor3 = Color3.fromRGB(100, 50, 150)
MinimizeBtn.Text = "âˆ’"
MinimizeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeBtn.TextSize = 22
MinimizeBtn.Font = Enum.Font.GothamBold
MinimizeBtn.BorderSizePixel = 0
MinimizeBtn.Parent = TopBar

local MinCorner = Instance.new("UICorner")
MinCorner.CornerRadius = UDim.new(0, 8)
MinCorner.Parent = MinimizeBtn

local CloseBtn = Instance.new("TextButton")
CloseBtn.Size = UDim2.new(0, 32, 0, 32)
CloseBtn.Position = UDim2.new(1, -32, 0, 9)
CloseBtn.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
CloseBtn.Text = "âœ•"
CloseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseBtn.TextSize = 18
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.BorderSizePixel = 0
CloseBtn.Parent = TopBar

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 8)
CloseCorner.Parent = CloseBtn

-- Content
local Content = Instance.new("Frame")
Content.Size = UDim2.new(1, -24, 1, -62)
Content.Position = UDim2.new(0, 12, 0, 55)
Content.BackgroundTransparency = 1
Content.Parent = MainFrame

-- Status Frame
local StatusFrame = Instance.new("Frame")
StatusFrame.Size = UDim2.new(1, 0, 0, 80)
StatusFrame.BackgroundColor3 = Color3.fromRGB(25, 15, 35)
StatusFrame.BorderSizePixel = 0
StatusFrame.Parent = Content

local StatusCorner = Instance.new("UICorner")
StatusCorner.CornerRadius = UDim.new(0, 10)
StatusCorner.Parent = StatusFrame

StatusLabel = Instance.new("TextLabel")
StatusLabel.Size = UDim2.new(1, -16, 0, 28)
StatusLabel.Position = UDim2.new(0, 8, 0, 6)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "â­• INACTIVE"
StatusLabel.TextColor3 = Color3.fromRGB(255, 150, 150)
StatusLabel.TextSize = 16
StatusLabel.Font = Enum.Font.GothamBold
StatusLabel.TextXAlignment = Enum.TextXAlignment.Left
StatusLabel.Parent = StatusFrame

StatsLabel = Instance.new("TextLabel")
StatsLabel.Size = UDim2.new(1, -16, 0, 22)
StatsLabel.Position = UDim2.new(0, 8, 0, 36)
StatsLabel.BackgroundTransparency = 1
StatsLabel.Text = "ðŸ’Ž +180 â†’ +1.00M per training"
StatsLabel.TextColor3 = Color3.fromRGB(100, 255, 255)
StatsLabel.TextSize = 14
StatsLabel.Font = Enum.Font.GothamBold
StatsLabel.TextXAlignment = Enum.TextXAlignment.Left
StatsLabel.Parent = StatusFrame

SessionLabel = Instance.new("TextLabel")
SessionLabel.Size = UDim2.new(1, -16, 0, 18)
SessionLabel.Position = UDim2.new(0, 8, 0, 58)
SessionLabel.BackgroundTransparency = 1
SessionLabel.Text = "ðŸŽ¯ Sessions: 0 | Boosted: +0"
SessionLabel.TextColor3 = Color3.fromRGB(200, 200, 220)
SessionLabel.TextSize = 11
SessionLabel.Font = Enum.Font.Gotham
SessionLabel.TextXAlignment = Enum.TextXAlignment.Left
SessionLabel.Parent = StatusFrame

-- Multiplier Frame
local MultFrame = Instance.new("Frame")
MultFrame.Size = UDim2.new(1, 0, 0, 110)
MultFrame.Position = UDim2.new(0, 0, 0, 88)
MultFrame.BackgroundColor3 = Color3.fromRGB(25, 15, 35)
MultFrame.BorderSizePixel = 0
MultFrame.Parent = Content

local MultCorner = Instance.new("UICorner")
MultCorner.CornerRadius = UDim.new(0, 10)
MultCorner.Parent = MultFrame

MultTitle = Instance.new("TextLabel")
MultTitle.Size = UDim2.new(1, -16, 0, 28)
MultTitle.Position = UDim2.new(0, 8, 0, 6)
MultTitle.BackgroundTransparency = 1
MultTitle.Text = "âš¡ MULTIPLIER: x5.56K"
MultTitle.TextColor3 = Color3.fromRGB(255, 255, 100)
MultTitle.TextSize = 17
MultTitle.Font = Enum.Font.GothamBold
MultTitle.TextXAlignment = Enum.TextXAlignment.Left
MultTitle.Parent = MultFrame

local MultInfo = Instance.new("TextLabel")
MultInfo.Size = UDim2.new(1, -16, 0, 20)
MultInfo.Position = UDim2.new(0, 8, 0, 34)
MultInfo.BackgroundTransparency = 1
MultInfo.Text = "Slide: x1K - x1M | Presets below"
MultInfo.TextColor3 = Color3.fromRGB(200, 200, 220)
MultInfo.TextSize = 12
MultInfo.Font = Enum.Font.Gotham
MultInfo.TextXAlignment = Enum.TextXAlignment.Left
MultInfo.Parent = MultFrame

local MultSlider = Instance.new("Frame")
MultSlider.Size = UDim2.new(1, -16, 0, 34)
MultSlider.Position = UDim2.new(0, 8, 0, 58)
MultSlider.BackgroundColor3 = Color3.fromRGB(15, 10, 25)
MultSlider.BorderSizePixel = 0
MultSlider.Parent = MultFrame

local SliderCorner = Instance.new("UICorner")
SliderCorner.CornerRadius = UDim.new(0, 8)
SliderCorner.Parent = MultSlider

MultFill = Instance.new("Frame")
MultFill.Size = UDim2.new(0.005, 0, 1, 0)
MultFill.BackgroundColor3 = Color3.fromRGB(255, 100, 255)
MultFill.BorderSizePixel = 0
MultFill.Parent = MultSlider

local FillCorner = Instance.new("UICorner")
FillCorner.CornerRadius = UDim.new(0, 8)
FillCorner.Parent = MultFill

local MultBtn = Instance.new("TextButton")
MultBtn.Size = UDim2.new(1, 0, 1, 0)
MultBtn.BackgroundTransparency = 1
MultBtn.Text = ""
MultBtn.Parent = MultSlider

MultValue = Instance.new("TextLabel")
MultValue.Size = UDim2.new(1, 0, 1, 0)
MultValue.BackgroundTransparency = 1
MultValue.Text = "x5.56K"
MultValue.TextColor3 = Color3.fromRGB(255, 255, 255)
MultValue.TextSize = 15
MultValue.Font = Enum.Font.GothamBold
MultValue.Parent = MultSlider

-- Preset Buttons
local PresetFrame = Instance.new("Frame")
PresetFrame.Size = UDim2.new(1, 0, 0, 38)
PresetFrame.Position = UDim2.new(0, 0, 0, 206)
PresetFrame.BackgroundTransparency = 1
PresetFrame.Parent = Content

local Preset1M = Instance.new("TextButton")
Preset1M.Size = UDim2.new(0.32, 0, 1, 0)
Preset1M.BackgroundColor3 = Color3.fromRGB(50, 150, 100)
Preset1M.Text = "1M"
Preset1M.TextColor3 = Color3.fromRGB(255, 255, 255)
Preset1M.TextSize = 15
Preset1M.Font = Enum.Font.GothamBold
Preset1M.BorderSizePixel = 0
Preset1M.Parent = PresetFrame

local P1Corner = Instance.new("UICorner")
P1Corner.CornerRadius = UDim.new(0, 8)
P1Corner.Parent = Preset1M

local Preset10M = Instance.new("TextButton")
Preset10M.Size = UDim2.new(0.32, 0, 1, 0)
Preset10M.Position = UDim2.new(0.34, 0, 0, 0)
Preset10M.BackgroundColor3 = Color3.fromRGB(255, 150, 50)
Preset10M.Text = "10M"
Preset10M.TextColor3 = Color3.fromRGB(255, 255, 255)
Preset10M.TextSize = 15
Preset10M.Font = Enum.Font.GothamBold
Preset10M.BorderSizePixel = 0
Preset10M.Parent = PresetFrame

local P2Corner = Instance.new("UICorner")
P2Corner.CornerRadius = UDim.new(0, 8)
P2Corner.Parent = Preset10M

local Preset100M = Instance.new("TextButton")
Preset100M.Size = UDim2.new(0.32, 0, 1, 0)
Preset100M.Position = UDim2.new(0.68, 0, 0, 0)
Preset100M.BackgroundColor3 = Color3.fromRGB(255, 50, 100)
Preset100M.Text = "100M"
Preset100M.TextColor3 = Color3.fromRGB(255, 255, 255)
Preset100M.TextSize = 15
Preset100M.Font = Enum.Font.GothamBold
Preset100M.BorderSizePixel = 0
Preset100M.Parent = PresetFrame

local P3Corner = Instance.new("UICorner")
P3Corner.CornerRadius = UDim.new(0, 8)
P3Corner.Parent = Preset100M

-- Main Buttons
local EnableBtn = Instance.new("TextButton")
EnableBtn.Size = UDim2.new(1, 0, 0, 52)
EnableBtn.Position = UDim2.new(0, 0, 0, 252)
EnableBtn.BackgroundColor3 = Color3.fromRGB(150, 50, 200)
EnableBtn.Text = "ðŸš€ ACTIVATE"
EnableBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
EnableBtn.TextSize = 19
EnableBtn.Font = Enum.Font.GothamBold
EnableBtn.BorderSizePixel = 0
EnableBtn.Parent = Content

local EnableCorner = Instance.new("UICorner")
EnableCorner.CornerRadius = UDim.new(0, 10)
EnableCorner.Parent = EnableBtn

local EnableStroke = Instance.new("UIStroke")
EnableStroke.Color = Color3.fromRGB(200, 100, 255)
EnableStroke.Thickness = 2
EnableStroke.Parent = EnableBtn

local AutoBtn = Instance.new("TextButton")
AutoBtn.Size = UDim2.new(1, 0, 0, 42)
AutoBtn.Position = UDim2.new(0, 0, 0, 312)
AutoBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 70)
AutoBtn.Text = "ðŸ¤– AUTO TRAIN: OFF"
AutoBtn.TextColor3 = Color3.fromRGB(200, 200, 220)
AutoBtn.TextSize = 15
AutoBtn.Font = Enum.Font.GothamBold
AutoBtn.BorderSizePixel = 0
AutoBtn.Parent = Content

local AutoCorner = Instance.new("UICorner")
AutoCorner.CornerRadius = UDim.new(0, 10)
AutoCorner.Parent = AutoBtn

-- Minimized Frame
local MinimizedFrame = Instance.new("Frame")
MinimizedFrame.Size = UDim2.new(0, 220, 0, 50)
MinimizedFrame.Position = UDim2.new(0.5, -110, 0, 10)
MinimizedFrame.BackgroundColor3 = Color3.fromRGB(30, 15, 40)
MinimizedFrame.BorderSizePixel = 0
MinimizedFrame.Visible = false
MinimizedFrame.Active = true
MinimizedFrame.Draggable = true
MinimizedFrame.Parent = ScreenGui

local MinFrameCorner = Instance.new("UICorner")
MinFrameCorner.CornerRadius = UDim.new(0, 10)
MinFrameCorner.Parent = MinimizedFrame

local MinLabel = Instance.new("TextLabel")
MinLabel.Size = UDim2.new(1, -50, 1, 0)
MinLabel.Position = UDim2.new(0, 10, 0, 0)
MinLabel.BackgroundTransparency = 1
MinLabel.Text = "âš¡ EXTREME BOOSTER"
MinLabel.TextColor3 = Color3.fromRGB(255, 100, 255)
MinLabel.TextSize = 16
MinLabel.Font = Enum.Font.GothamBold
MinLabel.TextXAlignment = Enum.TextXAlignment.Left
MinLabel.Parent = MinimizedFrame

local RestoreBtn = Instance.new("TextButton")
RestoreBtn.Size = UDim2.new(0, 38, 0, 38)
RestoreBtn.Position = UDim2.new(1, -44, 0, 6)
RestoreBtn.BackgroundColor3 = Color3.fromRGB(150, 50, 200)
RestoreBtn.Text = "+"
RestoreBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
RestoreBtn.TextSize = 24
RestoreBtn.Font = Enum.Font.GothamBold
RestoreBtn.BorderSizePixel = 0
RestoreBtn.Parent = MinimizedFrame

local RestoreCorner = Instance.new("UICorner")
RestoreCorner.CornerRadius = UDim.new(0, 8)
RestoreCorner.Parent = RestoreBtn

-- Slider Logic
local dragging = false
MultBtn.MouseButton1Down:Connect(function() dragging = true end)
UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
end)

RunService.RenderStepped:Connect(function()
    if dragging then
        local pos = math.clamp((UserInputService:GetMouseLocation().X - MultSlider.AbsolutePosition.X) / MultSlider.AbsoluteSize.X, 0, 1)
        Settings.GainMultiplier = math.floor(1000 * math.pow(1000, pos))
        SafeUpdateUI()
    end
end)

-- Button Events
MinimizeBtn.MouseButton1Click:Connect(function()
    MainFrame.Visible = false
    MinimizedFrame.Visible = true
end)

RestoreBtn.MouseButton1Click:Connect(function()
    MainFrame.Visible = true
    MinimizedFrame.Visible = false
end)

CloseBtn.MouseButton1Click:Connect(function()
    if not Settings.Enabled then ScreenGui:Destroy() else Notify("Deactivate first!") end
end)

Preset1M.MouseButton1Click:Connect(function()
    Settings.GainMultiplier = 5556
    SafeUpdateUI()
    Notify("Set to 1M per training!")
end)

Preset10M.MouseButton1Click:Connect(function()
    Settings.GainMultiplier = 55556
    SafeUpdateUI()
    Notify("Set to 10M per training!")
end)

Preset100M.MouseButton1Click:Connect(function()
    Settings.GainMultiplier = 555556
    SafeUpdateUI()
    Notify("Set to 100M per training!")
end)

EnableBtn.MouseButton1Click:Connect(function()
    Settings.Enabled = not Settings.Enabled
    if Settings.Enabled then
        EnableBtn.BackgroundColor3 = Color3.fromRGB(100, 255, 100)
        EnableBtn.Text = "âœ… ACTIVE"
        EnableStroke.Color = Color3.fromRGB(150, 255, 150)
        StatusLabel.Text = "ðŸ”¥ ACTIVE!"
        StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        Notify(string.format("ACTIVATED! Gain: +%s", FormatNumber(180 * Settings.GainMultiplier)))
    else
        EnableBtn.BackgroundColor3 = Color3.fromRGB(150, 50, 200)
        EnableBtn.Text = "ðŸš€ ACTIVATE"
        EnableStroke.Color = Color3.fromRGB(200, 100, 255)
        StatusLabel.Text = "â­• INACTIVE"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 150, 150)
        Notify("DEACTIVATED")
    end
end)

AutoBtn.MouseButton1Click:Connect(function()
    Settings.AutoTrain = not Settings.AutoTrain
    if Settings.AutoTrain then
        AutoBtn.BackgroundColor3 = Color3.fromRGB(100, 200, 255)
        AutoBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        AutoBtn.Text = "ðŸ¤– AUTO TRAIN: ON"
    else
        AutoBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 70)
        AutoBtn.TextColor3 = Color3.fromRGB(200, 200, 220)
        AutoBtn.Text = "ðŸ¤– AUTO TRAIN: OFF"
    end
end)

-- CORE HOOKING
local oldNamecall
oldNamecall = hookmetamethod(game, "__namecall", newcclosure(function(self, ...)
    if not Settings.Enabled then return oldNamecall(self, ...) end
    
    local method = getnamecallmethod()
    local args = {...}
    
    if method == "InvokeServer" then
        local results = {oldNamecall(self, ...)}
        for i = 1, #results do
            if typeof(results[i]) == "number" and results[i] > 10 then
                local original = results[i]
                results[i] = results[i] * Settings.GainMultiplier
                Stats.TotalGains = Stats.TotalGains + (results[i] - original)
            end
        end
        return unpack(results)
    end
    
    if method == "FireServer" and self.Name == "TrainSpeedHasChanged" then
        if args[1] then args[1] = 999999 end
        Stats.TrainingSessions = Stats.TrainingSessions + 1
        SafeUpdateUI()
    end
    
    return oldNamecall(self, unpack(args))
end))

-- Hook BindableFunctions
spawn(function()
    wait(2)
    for _, obj in pairs(ReplicatedStorage:GetDescendants()) do
        if obj:IsA("BindableFunction") then
            pcall(function()
                local old = obj.Invoke
                obj.Invoke = newcclosure(function(self, ...)
                    local res = old(self, ...)
                    if Settings.Enabled and typeof(res) == "number" and res > 10 then
                        return res * Settings.GainMultiplier
                    end
                    return res
                end)
            end)
        end
    end
end)

-- Auto Train
spawn(function()
    while wait(0.15) do
        if Settings.AutoTrain and Settings.Enabled then
            pcall(function()
                local te = ReplicatedStorage:FindFirstChild("TrainEquipment")
                if te and te:FindFirstChild("Remote") then
                    local st = te.Remote:FindFirstChild("ApplyStationaryTrain")
                    if st then st:InvokeServer() end
                end
            end)
        end
    end
end)

SafeUpdateUI()
Notify("Script loaded! Set preset and ACTIVATE")
print("âš¡ EXTREME BOOSTER LOADED!")
print("ðŸ’Ž Preset: 1M/10M/100M available")
print("ðŸš€ Press ACTIVATE to start!")
